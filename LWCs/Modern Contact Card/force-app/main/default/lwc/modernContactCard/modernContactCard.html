<template>
    <article class={cardContainerClass}>
        <!-- Header Background Banner -->
        <div class="header-background" style={headerBackgroundStyle}>
            <!-- Top Controls: Health Pill and Menu Button -->
            <div class="header-controls">
                <!-- Health Score Pill -->
                <template if:true={showHealthPill}>
                    <div class="health-pill">
                        <span class="health-dot" style={healthDotStyle}></span>
                        <span class="health-text">{healthScoreLabel}: {displayHealthScore}</span>
                    </div>
                </template>
                
                <!-- Menu Button -->
                <lightning-button-menu
                    alternative-text="Actions"
                    variant="border-filled"
                    icon-size="x-small"
                    menu-alignment="right"
                    class="menu-button"
                    onselect={handleMenuSelect}
                >
                    <lightning-menu-item value="view" label="View Details"></lightning-menu-item>
                    <lightning-menu-item value="edit" label="Edit Contact"></lightning-menu-item>
                    <lightning-menu-item value="email" label="Send Email"></lightning-menu-item>
                </lightning-button-menu>
            </div>
        </div>

        <!-- Profile Section (overlaps banner) -->
        <header class="card-header">
            <div class="profile-row">
                <!-- Profile Image with Status -->
                <div class="profile-image-wrapper">
                    <img 
                        src={displayProfileImage} 
                        alt={displayName}
                        class="profile-image"
                        onerror={handleImageError}
                    />
                    <span class="status-indicator" title="Online"></span>
                </div>
                
                <!-- Name, Location, and Tags next to profile image -->
                <div class="profile-info">
                    <h1 class="contact-name">{displayName}</h1>
                    <div class="info-row">
                        <div class="location-wrapper">
                            <lightning-icon 
                                icon-name="utility:location" 
                                size="xx-small"
                                alternative-text="Location"
                            ></lightning-icon>
                            <span class="location-text">{displayLocation}</span>
                        </div>
                        
                        <!-- Tags -->
                        <template if:true={showTagsPills}>
                            <div class="tags-wrapper">
                                <template for:each={displayTags} for:item="tag">
                                    <span key={tag.id} class="tag-pill" style={tag.style}>{tag.label}</span>
                                </template>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </header>

        <!-- Data Fields Grid -->
        <section class="data-section">
            <div class="data-grid">
                <!-- Row 1 -->
                <div class="data-item" if:true={showField1}>
                    <div class="data-icon">
                        <lightning-icon icon-name={field1Icon} size="x-small" alternative-text={field1Label}></lightning-icon>
                    </div>
                    <div class="data-content">
                        <span class="data-label">{field1Label}</span>
                        <span class="data-value">{displayField1Value}</span>
                    </div>
                </div>
                
                <div class="data-item" if:true={showField2}>
                    <div class="data-icon">
                        <lightning-icon icon-name={field2Icon} size="x-small" alternative-text={field2Label}></lightning-icon>
                    </div>
                    <div class="data-content">
                        <span class="data-label">{field2Label}</span>
                        <span class="data-value">{displayField2Value}</span>
                    </div>
                </div>

                <!-- Row 2 -->
                <div class="data-item" if:true={showField3}>
                    <div class="data-icon">
                        <lightning-icon icon-name={field3Icon} size="x-small" alternative-text={field3Label}></lightning-icon>
                    </div>
                    <div class="data-content">
                        <span class="data-label">{field3Label}</span>
                        <span class="data-value">{displayField3Value}</span>
                    </div>
                </div>
                
                <div class="data-item" if:true={showField4}>
                    <div class="data-icon">
                        <lightning-icon icon-name={field4Icon} size="x-small" alternative-text={field4Label}></lightning-icon>
                    </div>
                    <div class="data-content">
                        <span class="data-label">{field4Label}</span>
                        <span class="data-value">{displayField4Value}</span>
                    </div>
                </div>

                <!-- Row 3 -->
                <div class="data-item" if:true={showField5}>
                    <div class="data-icon">
                        <lightning-icon icon-name={field5Icon} size="x-small" alternative-text={field5Label}></lightning-icon>
                    </div>
                    <div class="data-content">
                        <span class="data-label">{field5Label}</span>
                        <span class="data-value">{displayField5Value}</span>
                    </div>
                </div>
                
                <div class="data-item" if:true={showField6}>
                    <div class="data-icon">
                        <lightning-icon icon-name={field6Icon} size="x-small" alternative-text={field6Label}></lightning-icon>
                    </div>
                    <div class="data-content">
                        <span class="data-label">{field6Label}</span>
                        <span class="data-value">{displayField6Value}</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Brand Affinities Section -->
        <template if:true={showBrandSection}>
            <section class="brand-section">
                <div class="brand-grid">
                    <template for:each={displayBrands} for:item="brand">
                        <div key={brand.id} class="brand-item">
                            <div class="brand-image-container">
                                <img src={brand.image} alt={brand.name} class="brand-image" />
                            </div>
                            <span class="brand-label">{brand.name}</span>
                        </div>
                    </template>
                </div>
            </section>
        </template>

        <!-- Chart Section -->
        <template if:true={showChart}>
            <section class="chart-section">
                <div class="chart-header">
                    <h2 class="chart-title">{chartTitle}</h2>
                    <div class="chart-legend">
                        <div class="legend-item">
                            <span class="legend-dot" style={engagementDotStyle}></span>
                            <span class="legend-text">{engagementLabel}</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-dot" style={satisfactionDotStyle}></span>
                            <span class="legend-text">{satisfactionLabel}</span>
                        </div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas class="chart-canvas" lwc:ref="chartCanvas"></canvas>
                </div>
            </section>
        </template>
    </article>
</template>
